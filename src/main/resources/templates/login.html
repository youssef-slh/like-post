<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Like Post</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    <link rel="stylesheet" type="text/css" href="css/animate.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/line-awesome.css">
    <link rel="stylesheet" type="text/css" href="css/line-awesome-font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="lib/slick/slick.css">
    <link rel="stylesheet" type="text/css" href="lib/slick/slick-theme.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/responsive.css">
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
</head>


<body class="sign-in">


<div class="wrapper">


    <div class="sign-in-page">
        <div class="signin-popup">
            <div class="signin-pop">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="cmp-info">
                            <div class="cm-logo">
                                <img src="images/cm-logo.png" alt="">
                                <p>Likepost, is a global freelancing platform and social networking where businesses and
                                    independent professionals connect and collaborate remotely</p>
                            </div><!--cm-logo end-->
                            <img src="images/cm-main-img.png" alt="">
                        </div><!--cmp-info end-->
                    </div>
                    <div class="col-lg-6">
                        <div class="login-sec">
                            <ul class="sign-control">
                                <li data-tab="tab-1" class="current"><a href="#" title="">Sign in</a></li>
                                <li data-tab="tab-2"><a href="#" title="">Sign up</a></li>
                            </ul>
                            <div class="sign_in_sec current" id="tab-1">

                                <h3>Sign in</h3>
                                <form method="post" action="/login">
                                    <div class="row">
                                        <div class="col-lg-12 no-pdd">
                                            <div class="sn-field">
                                                <input type="text" id="login-email" name="username" placeholder="Email">
                                                <i class="la la-user"></i>
                                                <small>Invalid Input</small>
                                            </div><!--sn-field end-->
                                        </div>
                                        <div class="col-lg-12 no-pdd">
                                            <div class="sn-field">
                                                <input type="password" id="password" name="password"
                                                       placeholder="Password">
                                                <i class="la la-lock"></i>
                                                <div class="message">
                                                    <small>Invalid Input</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-12 no-pdd">
                                            <div class="checky-sec">
                                                <div class="fgt-sec">
                                                    <input type="checkbox" name="cc" id="c1">
                                                    <label for="c1">
                                                        <span></span>
                                                    </label>
                                                    <small>Remember me</small>
                                                </div><!--fgt-sec end-->
                                                <a href="#" title="">Forgot Password?</a>
                                            </div>
                                        </div>
                                        <div class="col-lg-12 no-pdd">
                                            <button type="submit" value="submit">Sign in</button>
                                        </div>
                                    </div>
                                </form>
                                <div class="login-resources">
                                    <h4>Login Via Social Account</h4>
                                    <ul>
                                        <li><a href="#" title="" class="fb"><i class="fa fa-facebook"></i>Login Via
                                            Facebook</a></li>
                                        <li><a href="#" title="" class="tw"><i class="fa fa-twitter"></i>Login Via
                                            Twitter</a></li>
                                    </ul>
                                </div><!--login-resources end-->
                            </div><!--sign_in_sec end-->
                            <div class="sign_in_sec" id="tab-2">
                                <div class="dff-tab current" id="tab-3">
                                    <h3>Sign up</h3>
                                    <form id="registration-form">
                                        <div class="row">
                                            <div class="col-lg-12 no-pdd">
                                                <div class="sn-field">
                                                    <input type="text" id="firstName" name="firstName"
                                                           placeholder="First Name">
                                                    <i class="la la-user"></i>
                                                    <small>Invalid Input</small>
                                                </div><!--sn-field end-->
                                            </div>
                                            <div class="col-lg-12 no-pdd">
                                                <div class="sn-field ">
                                                    <input type="text" id="lastName" name="lastName"
                                                           placeholder="Last Name">
                                                    <i class="la la-user"></i>
                                                    <small>Invalid Input</small>
                                                </div>

                                            </div>
                                            <div class="col-lg-12 no-pdd">
                                                <div class="sn-field">
                                                    <input type="date" id="dateOfBirth" name="dateOfBirth"
                                                           placeholder="yyyy-mm-dd">
                                                    <i class="la la-user"></i>
                                                    <small>Invalid Input</small>
                                                </div>

                                            </div>
                                            <div class="col-lg-12 no-pdd ">
                                                <div class="sn-field">
                                                    <select id="country">
                                                        <option
                                                                value="0">None
                                                        </option>
                                                        <option th:each="Country : ${countries}"
                                                                th:value="${Country.id}" th:text="${Country.name}">
                                                        </option>
                                                    </select>
                                                    <i class="la la-dropbox"></i>
                                                    <span><i class="fa fa-ellipsis-h"></i></span>
                                                    <small>Invalid Input</small>
                                                </div>

                                            </div>
                                            <div class="col-lg-12 no-pdd">
                                                <div class="sn-field">
                                                    <input type="text" id="email" name="email"
                                                           placeholder="Email">
                                                    <i class="la la-user"></i>
                                                    <small>Invalid Email</small>
                                                </div>

                                            </div>
                                            <div class="col-lg-12 no-pdd ">
                                                <div class="sn-field">
                                                    <input type="password" id="register_password" name="password"
                                                           placeholder="Password">
                                                    <i class="la la-lock"></i>
                                                    <small class="message">Invalid Password</small>
                                                </div>

                                            </div>
                                            <div class="col-lg-12 no-pdd">
                                                <div class="sn-field">
                                                    <input type="password" id="repeat-password"
                                                           name="repeat-password"
                                                           placeholder="Repeat Password">
                                                    <i class="la la-lock"></i>
                                                    <small class="message">Invalid Password</small>
                                                </div>

                                            </div>
                                            <div class="col-lg-12 no-pdd ">
                                                <div class="checky-sec st2">
                                                    <div class="fgt-sec">
                                                        <input type="checkbox" name="cc" id="c2">
                                                        <label for="c2">
                                                            <span></span>
                                                        </label>
                                                        <small>Yes, I understand and agree to the LikePost Terms &
                                                            Conditions.
                                                        </small>
                                                    </div><!--fgt-sec end-->
                                                </div>
                                            </div>
                                            <div class="col-lg-12 no-pdd">
                                                <button type="submit" value="submit">Get Started</button>
                                            </div>
                                        </div>
                                    </form>
                                </div><!--dff-tab end-->
                            </div>
                        </div><!--login-sec end-->
                    </div>
                </div>
            </div><!--signin-pop end-->
        </div><!--signin-popup end-->
        <div class="footy-sec">
            <div class="container">

                <p><img src="images/copy-icon.png" alt="">Copyright 2022</p>
            </div>
        </div><!--footy-sec end-->
    </div><!--sign-in-page end-->

</div><!--theme-layout end-->
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/popper.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="lib/slick/slick.min.js"></script>
<script type="text/javascript" src="js/script.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

<script>
    toastr.options = {
        "debug": false,
        "positionClass": "toast-bottom-full-width",
        "onclick": null,
        "fadeIn": 300,
        "fadeOut": 1000,
        "timeOut": 5000,
        "extendedTimeOut": 1000
    }

    const registrationForm = document.getElementById('registration-form');
    const firstName = document.getElementById('firstName');
    const lastName = document.getElementById('lastName');
    const email = document.getElementById('email');
    const dateOfBirth = document.getElementById('dateOfBirth');
    const country = document.getElementById('country');
    const register_password = document.getElementById('register_password');
    const repeat_password = document.getElementById('repeat-password');
    var formIsValid = false;

    registrationForm.addEventListener('submit', function (e) {
        var formValidationToast = document.getElementById("FormValidationError");
        // prevent the form from submitting
        e.preventDefault();
        if ($('#c2').is(':checked')) {
            checkInputs();
            console.log(formIsValid);
            if (formIsValid === true) {

                const firstNameValue = firstName.value.trim();
                const lastNameValue = lastName.value.trim();
                const emailValue = email.value.trim();
                const dateOfBirthValue = dateOfBirth.value.trim();
                const regpasswordValue = register_password.value.trim();
                const countryValue = country.value.trim();

                var userSecurity = {
                    "email": emailValue,
                    "password": regpasswordValue,
                    "isLocked": true,
                    "isActive": true,
                    "isExpired": true,
                    "user": {
                        "firstName": firstNameValue,
                        "lastName": lastNameValue,
                        "dateOfBirth": dateOfBirthValue,
                        "country": {
                            "id": countryValue
                        }
                    }
                };
                //loadPage("EmailVerification");

                $.ajax({
                    type: "POST",
                    contentType: "application/json",
                    url: "/api/v1/User",
                    data: JSON.stringify(userSecurity),
                    timeout: 100000,
                    success: function (data) {
                        window.location.href="/EmailVerification?email="+emailValue;
                    },
                    error: function(xhr, status, error) {
                        console.log(error);
                    },
                    done: function (e) {
                        console.log("DONE");
                    }
                });

            } else {
                toastr.error("Invalid Inputs");
            }

        } else {
            toastr.error("You should agree to the LikePost Terms & Conditions before registration");
        }
    });


    function loadPage(theUrl) {
        $.get(theUrl, function(data, status){
            window.open(data, '_self').focus();
        });
    }

    function checkInputs() {

        console.log(firstName);
        // trim to remove the whitespaces
        const firstNameValue = firstName.value.trim();
        const lastNameValue = lastName.value.trim();
        const emailValue = email.value.trim();
        const dateOfBirthValue = dateOfBirth.value.trim();
        const regpasswordValue = register_password.value.trim();
        const password2Value = repeat_password.value.trim();
        const countryValue = country.value.trim();

        if (firstNameValue === '') {
            setErrorFor(firstName, 'First Name cannot be blank');

        } else {
            setSuccessFor(firstName);
        }

        if (lastNameValue === '') {
            setErrorFor(lastName, 'Last Name cannot be blank');
        } else {
            setSuccessFor(lastName);
        }

        if (countryValue === '0') {
            setErrorFor(country, 'Country cannot be blank');
        } else {
            console.log("country is not null")
            setSuccessFor(country);
        }

        let isValidDate = Date.parse(dateOfBirthValue);

        if (isNaN(isValidDate)) {
            setErrorFor(dateOfBirth, 'Birth Date is not valid');
        } else {
            setSuccessFor(dateOfBirth);
        }

        if (emailValue === '') {
            setErrorFor(email, 'Email cannot be blank');
        } else if (!isEmail(emailValue)) {
            setErrorFor(email, 'Not a valid email');
        } else {
            setSuccessFor(email);
        }

        if (regpasswordValue === '') {
            setErrorFor(register_password, 'Password cannot be blank');
        } else {
            setSuccessFor(register_password);
        }

        if (password2Value === '') {
            setErrorFor(repeat_password, 'Password cannot be blank');
        } else if (regpasswordValue !== password2Value) {
            setErrorFor(repeat_password, 'Passwords does not match');
        } else {
            setSuccessFor(repeat_password);
        }
    }

    function setErrorFor(input, message) {
        formIsValid = false;
        const formControl = input.parentElement;
        const small = formControl.querySelector('small');
        formControl.className = 'sn-field error';
        small.innerText = message;
    }

    function setSuccessFor(input) {
        formIsValid = true;
        const formControl = input.parentElement;
        formControl.className = 'sn-field success';
    }

    function isEmail(email) {
        return /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email);
    }

    function dateIsValid(dateStr) {
        const regex = /^\d{2}\/\d{2}\/\d{4}$/;

        if (dateStr.match(regex) === null) {
            return false;
        }

        const [day, month, year] = dateStr.split('/');

        // 👇️ format Date string as `yyyy-mm-dd`
        const isoFormattedStr = `${year}-${month}-${day}`;

        const date = new Date(isoFormattedStr);

        const timestamp = date.getTime();

        if (typeof timestamp !== 'number' || Number.isNaN(timestamp)) {
            return false;
        }

        return date.toISOString().startsWith(isoFormattedStr);
    }
</script>
</body>
</html>